<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Explore the Score Distillation Sampling technique | Minh-Tuan Bui </title> <meta name="author" content="Minh-Tuan Bui"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/my-blog/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/my-blog/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/my-blog/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/my-blog/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/my-blog/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://tomasbuidev.github.io/my-blog/blog/2024/sds/"> <script src="/my-blog/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/my-blog/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css" integrity="sha256-q9ba7o845pMPFU+zcAll8rv+gC+fSovKsOoNQ6cynuQ=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" integrity="sha256-Oppd74ucMR5a5Dq96FxjEzGF7tTw2fZ/6ksAqDCM8GY=" crossorigin="anonymous" media="screen and (prefers-color-scheme: light)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" integrity="sha256-nyCNAiECsdDHrr/s2OQsp5l9XeY2ZJ0rMepjCT2AkBk=" crossorigin="anonymous" media="screen and (prefers-color-scheme: dark)"> <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/css/diff2html.min.css" integrity="sha256-IMBK4VNZp0ivwefSn51bswdsrhk0HoMTLc2GqFHFBXg=" crossorigin="anonymous"> <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css"> <script src="/my-blog/assets/js/distillpub/template.v2.js"></script> <script src="/my-blog/assets/js/distillpub/transforms.v2.js"></script> <script src="/my-blog/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Explore the Score Distillation Sampling technique",
            "description": "",
            "published": "June 21, 2024",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/my-blog/"> <span class="font-weight-bold">Minh-Tuan</span> Bui </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/my-blog/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/my-blog/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/my-blog/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/my-blog/projects/">projects </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/my-blog/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/my-blog/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/my-blog/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Explore the Score Distillation Sampling technique</h1> <p></p> </d-title> <d-article> <p>In this post, I will delve into Score Distillation Sampling (SDS), the core method powering <a href="https://arxiv.org/abs/2209.14988" rel="external nofollow noopener" target="_blank">DreamFusion</a></p> <div class="row"> <div class="mx-auto col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/my-blog/assets/img/sds/dreamfusion-480.webp 480w,/my-blog/assets/img/sds/dreamfusion-800.webp 800w,/my-blog/assets/img/sds/dreamfusion-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/my-blog/assets/img/sds/dreamfusion.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> DreamFusion training diagram. The image is from DreamFusion paper. </div> <hr> <p>DreamFusion is a text-to-3D synthesis pipeline that optimizes a Neural Radiance Field (NeRF) to align with a given text prompt. The synthesis procedure in DreamFusion is as follows:</p> <ol> <li>Randomly initialized NeRF from scratch</li> <li>Randomly sample a camera and light</li> <li>Using a differentiable render to render an image of the NeRF from that camera and shade with the light</li> <li>Compute gradient of the SDS loss w.r.t the NeRF params</li> <li>Update NeRF params and repeat from step 2</li> </ol> <p>At the core of DreamFusion lies the SDS loss, which we will explore.</p> <h3 id="my-sds-interpretation">My SDS interpretation</h3> <p>From my perspective, the SDS loss shares some similarities with the discriminator loss in GANs, as it evaluates the fidelity of an input image. However, unlike GANs where the discriminator is trained concurrently with the generator, SDS utilizes a pre-trained, frozen diffusion model as its discriminator.</p> <p>Assuming $\mathbf{x}=g_\theta (y)$ is the image generated by a generator $g$ parameterized by $\theta$ and $y$ is the input prompt, our objective is to optimize $\theta$ such that $\mathbf{x}$ looks like a sample $x_0 \sim p_0(x \vert y)$ implicitly defined by the frozen diffusion model. This objective means the diffusion loss given $x$ as the clean signal must be small. Specifically, we optimize:</p> \[\theta^*=\min_\theta \mathcal{L}_\mathrm{Diff}(\phi,\mathbf{x}=g_\theta(y))\] <p>where $\phi$ is params of the pretrained frozen diffusion model and</p> \[\mathcal{L}_\mathrm{Diff}(\phi,\mathbf{x})=\mathbb{E}_{t,\epsilon} || w(t)(\hat\epsilon_\phi(\mathbf{z}_t;y,t)-\epsilon) ||^2_2\] \[\mathbf{z}_t=\sqrt{\bar\alpha_t}\mathbf{x} + \sqrt{1-\bar\alpha_t}\epsilon\] <p>Note that here I assume we are using DDPM $\epsilon$-prediction type model.</p> <div class="row"> <div class="mx-auto col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/my-blog/assets/img/sds/train-480.webp 480w,/my-blog/assets/img/sds/train-800.webp 800w,/my-blog/assets/img/sds/train-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/my-blog/assets/img/sds/train.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="sds-loss">SDS Loss</h3> <p>In practice, it turn outs that the above loss doesn’t work well to produce realistic samples because computation of gradient of $\mathcal{L}_\mathrm{Diff}$ is unstable.</p> <p>If we break down gradient of $\mathcal{L}_\mathrm{Diff}$, we have</p> <div class="row"> <div class="mx-auto col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/my-blog/assets/img/sds/gradient_eqt-480.webp 480w,/my-blog/assets/img/sds/gradient_eqt-800.webp 800w,/my-blog/assets/img/sds/gradient_eqt-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/my-blog/assets/img/sds/gradient_eqt.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The authors of DreamFusion propose to omit the U-Net Jacobian terms because:</p> <ul> <li>It is expensive to compute</li> <li>It is poorly conditioned for small noise levels</li> </ul> <p>which results in $\theta$ being updated by the following gradient:</p> <div class="row"> <div class="mx-auto col-sm-9 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/my-blog/assets/img/sds/sds_formula-480.webp 480w,/my-blog/assets/img/sds/sds_formula-800.webp 800w,/my-blog/assets/img/sds/sds_formula-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/my-blog/assets/img/sds/sds_formula.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This formula is more concise and efficient since we no longer need to backpropagate through the diffusion network.</p> <h3 id="implementation">Implementation</h3> <p>There are two ways to update $\theta$ at each optimizing step:</p> <ol> <li>Directly compute $\nabla_\theta \mathcal{L}_\mathrm{SDS}$ via the above formula and use the result to update $\theta$</li> <li>Make pytorch and optimizer compute the gradient and update $\theta$. In order to do it, we have to find a \(\mathcal{L}_\mathrm{SDS}\) satisfying $\nabla_\theta \mathcal{L}_\mathrm{SDS}$, which is as simple as</li> </ol> \[\mathcal{L}_\mathrm{SDS}=\mathbb{E}_{t,\epsilon} \left[ w(t) (\hat\epsilon_\phi(\mathbf{z};y,t)-\epsilon) \mathbf{x} \right]\] <h3 id="limitations">Limitations</h3> <p>SDS has issues of mode collapse that generates non-diverse and blurry outputs that only highlight elements mentioned in the prompt, as shown in the image below.</p> <div class="row"> <div class="mx-auto col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/my-blog/assets/img/sds/limitation-480.webp 480w,/my-blog/assets/img/sds/limitation-800.webp 800w,/my-blog/assets/img/sds/limitation-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/my-blog/assets/img/sds/limitation.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/my-blog/assets/bibliography/2018-12-22-distill.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Minh-Tuan Bui. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/my-blog/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/js/diff2html-ui.min.js" integrity="sha256-eU2TVHX633T1o/bTQp6iIJByYJEtZThhF9bKz/DcbbY=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/diff2html-setup.js?80a6e52ce727518bbd3aed2bb6ba5601" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js" integrity="sha256-MgH13bFTTNqsnuEoqNPBLDaqxjGH+lCpqrukmXc8Ppg=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/leaflet-setup.js?b6313931e203b924523e2d8b75fe8874" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha256-0q+JdOlScWOHcunpUk21uab1jW7C1deBQARHtKMcaB4=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/chartjs-setup.js?183c5859923724fb1cb3c67593848e71" type="text/javascript"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js" integrity="sha256-QvgynZibb2U53SsVu98NggJXYqwRL7tg3FeyfXvPOUY=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/theme/dark-fresh-cut.js" integrity="sha256-sm6Ui9w41++ZCWmIWDLC18a6ki72FQpWDiYTDxEPXwU=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/echarts-setup.js?738178999630746a8d0cfc261fc47c2c" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega@5.27.0/build/vega.min.js" integrity="sha256-Yot/cfgMMMpFwkp/5azR20Tfkt24PFqQ6IQS+80HIZs=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3/build/vega-lite.min.js" integrity="sha256-TvBvIS5jUN4BSy009usRjNzjI1qRrHPYv7xVLJyjUyw=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0/build/vega-embed.min.js" integrity="sha256-FPCJ9JYCC9AZSpvC/t/wHBX7ybueZhIqOMjpWqfl3DU=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/vega-setup.js?7c7bee055efe9312afc861b128fe5f36" type="text/javascript"></script> <script defer src="https://tikzjax.com/v1/tikzjax.js" integrity="sha256-+1qyucCXRZJrCg3lm3KxRt/7WXaYhBid4/1XJRHGB1E=" crossorigin="anonymous"></script> <script src="/my-blog/assets/js/typograms.js?062e75bede72543443762dc3fe36c7a5"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/my-blog/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/my-blog/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/my-blog/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/my-blog/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/my-blog/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/my-blog/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/my-blog/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/my-blog/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/my-blog/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/my-blog/assets/js/search-data.js"></script> <script src="/my-blog/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>